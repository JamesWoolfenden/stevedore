# Gitleaks Configuration
# https://github.com/gitleaks/gitleaks

title = "Gitleaks Config for Faun Project"

[extend]
# useDefault will extend the base configuration with the default gitleaks config:
# https://github.com/gitleaks/gitleaks/blob/master/config/gitleaks.toml
useDefault = true

[allowlist]
description = "Allowlisted files and patterns"

# Paths to ignore
paths = [
  '''\.terraform/''',
  '''\.terraform\.lock\.hcl$''',
  '''node_modules/''',
  '''vendor/''',
  '''\.gitlab/''',
  '''\.git/''',
  '''terraform/SECRET_MANAGER_MIGRATION\.md$''',  # Example secrets in documentation
]

# Regexes to allowlist
regexes = [
  # Example placeholder values
  '''example\.com''',
  '''your-project-id''',
  '''your-secret-value''',
  '''REPLACE_ME''',
  '''TODO''',
  '''FIXME''',

  # Public OAuth client IDs (not secret)
  '''apps\.googleusercontent\.com''',

  # Terraform variable references
  '''var\.''',
  '''\$\{var\.''',

  # Secret Manager references (not actual secrets)
  '''secret_key_ref''',
  '''secret_manager''',
  '''google_secret_manager''',
]

# Stop words to ignore
stopwords = [
  "example",
  "placeholder",
  "sample",
  "dummy",
  "test",
]

# Custom rules specific to this project
[[rules]]
id = "gcp-service-account-key"
description = "Google Cloud service account private key"
regex = '''-----BEGIN PRIVATE KEY-----'''
tags = ["key", "GCP"]

[[rules]]
id = "gcp-api-key"
description = "Google Cloud API key"
regex = '''AIza[0-9A-Za-z\\-_]{35}'''
tags = ["key", "GCP", "API"]

[[rules]]
id = "github-pat"
description = "GitHub Personal Access Token"
regex = '''ghp_[0-9a-zA-Z]{36}'''
tags = ["key", "GitHub"]

[[rules]]
id = "github-oauth"
description = "GitHub OAuth Access Token"
regex = '''gho_[0-9a-zA-Z]{36}'''
tags = ["key", "GitHub"]

[[rules]]
id = "gitlab-pat"
description = "GitLab Personal Access Token"
regex = '''glpat-[0-9a-zA-Z\-_]{20}'''
tags = ["key", "GitLab"]

[[rules]]
id = "jwt-token"
description = "JSON Web Token"
regex = '''eyJ[A-Za-z0-9-_=]+\.eyJ[A-Za-z0-9-_=]+\.?[A-Za-z0-9-_.+/=]*'''
tags = ["key", "JWT"]
[rules.allowlist]
regexes = [
  '''example''',
  '''sample''',
]

[[rules]]
id = "slack-webhook"
description = "Slack Webhook"
regex = '''https://hooks\.slack\.com/services/T[a-zA-Z0-9_]{8}/B[a-zA-Z0-9_]{8}/[a-zA-Z0-9_]{24}'''
tags = ["key", "Slack"]

[[rules]]
id = "connection-string"
description = "Database connection string with credentials"
regex = '''postgresql://[a-zA-Z0-9]+:[a-zA-Z0-9]+@'''
tags = ["key", "database"]
[rules.allowlist]
regexes = [
  '''postgresql://postgres:.*@postgres\?host=/cloudsql''',  # Cloud SQL connection format
  '''\$\{''',  # Variable interpolation
]

[[rules]]
id = "private-key-file"
description = "Private key in file content"
regex = '''(?i)(-----BEGIN (RSA |DSA |EC |OPENSSH )?PRIVATE KEY-----)'''
tags = ["key", "private"]

[[rules]]
id = "generic-api-key"
description = "Generic API key pattern"
regex = '''(?i)(api[_-]?key|apikey)['\"]?\s*[:=]\s*['\""][a-zA-Z0-9_\-]{20,}['\""]'''
tags = ["key", "API"]
[rules.allowlist]
regexes = [
  '''var\.''',
  '''\$\{''',
  '''secret_key_ref''',
]
